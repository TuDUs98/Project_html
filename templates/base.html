<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin="anonymous">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_1.css') }}">

    <title>Как Так!?</title>

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
       (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
       m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
       (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

       ym(61244470, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
       });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/61244470" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->

</head>
<body>
<header>
    КакТак!?
</header>
<div class="sidebar_nav">
    <nav>
        {% if current_user.is_authenticated %}
        <h3 style="color: red;">{{current_user.name}}</h3>
        <h3 style="color: yellow;">{{current_user.rating}}</h3>
        <ul>
            <li><a href="/index">На главную</a></li>
            <li><a href="/profile">Профиль</a></li>
            <li><a href="/create_fact">Добавить факт</a></li>
            {% if current_user.name == 'admin' %}
            <li><a href="/facts">Все факты</a></li>
            {% endif %}
            <li><a href="/logout">Log out</a></li>
        </ul>
        {% else %}
        <ul>
            <li><a href="/index">На главную</a></li>
            <li><a href="/login">Sign in</a></li>
            <li><a href="/register">Sign up</a></li>
        </ul>
        {% endif %}
    </nav>
</div>
<script>
    var a = -1;
</script>
<main>
    {% set list_of_facts = list_of_fact %}
    <div class="content">
        {% block login %}{% endblock %}
        {% block index %}{% endblock %}
        {% block register %}{% endblock %}
        {% block submit_email %}{% endblock %}
        {% block create_fact %}{% endblock %}
    </div>
    {% if current_user.is_authenticated %}
    <div id="infinite-scroll"></div>
    <script>

        window.addEventListener("scroll", function(){

            var block = document.getElementById('infinite-scroll');
            var counter = 1;

            // высота блока контента вместе с границами
            var contentHeight = block.offsetHeight;      
            // текущее положение скролбара
            var yOffset = window.pageYOffset;   
            // высота внутренней области окна документа
            var window_height = window.innerHeight;      
            var y = yOffset + window_height;

            // если пользователь достиг конца
            if(y >= contentHeight){
                a = a + 1
                var s = String(a)
                block.innerHTML = block.innerHTML +
                '{% set b =' + s + ' %}'
                '<div class="fact">{{b}}</div>' +
                '<div class="fact">{% print(list_of_facts[]) %}</div>' 
                ;
            }
        });

    </script>
    <div class="end">На этом пока всё(</div>
    {% endif %}
</main>
{% if not current_user.is_authenticated %}
<footer>
    Что-бы листать ленту, зарегистрируйтесь!
</footer>     
{% endif %}                                                              
</body>
</html>